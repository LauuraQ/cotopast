<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä —Å–ø–∏—Å–∫–æ–≤ (Firebase)</title>
    <style>
        @charset "UTF-8";

        :root {
            --color-light-gray: #A6A6A6;
            --color-gray: #4A4A4A;
            --color-dark-gray: #222222;
            --color-white: #fff;
            --color-background-gray: #F5F5F5;
            --font-sans: "Inter", sans-serif;
            --color-blue-bg: #e3f2fd;
            --color-blue-border: #2196f3;
            --color-blue-text: #222222;
        }

        * {
            padding: 0;
            margin: 0;
            border: 0;
            background: transparent;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            width: 100%;
            font-family: var(--font-sans);
            color: var(--color-gray);

            ::selection {
                background-color: var(--color-light-gray);
                color: var(--color-white);
            }
        }

        input,
        button,
        textarea {
            font-family: inherit;
        }

        button {
            cursor: pointer;
            user-select: none;
        }

        ul li {
            list-style: none;
        }

        a {
            color: var(--color-dark-gray);
        }

        h1 {
            font-size: 2.6rem;
            font-weight: bold;
            color: var(--color-gray);
            margin: 30px 0 30px 0;
            text-align: center;
        }

        h2 {
            font-weight: bold;
            color: var(--color-gray);
            margin-top: 20px;
            margin-bottom: 25px;
            text-align: center;
        }

        .intro {
            text-align: center;
            max-width: 800px;
            margin: 0 auto 25px;
        }

        .centration-modif {
            max-width: 1300px;
            margin: 0 auto 56px;
            padding: 0 8px;

            .p {
                max-width: 800px;
            }
        }

        .wrapper {
            max-width: 1140px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header_container {
            padding-top: 40px;
            margin-bottom: 50px;
        }

        .footer_container {
            padding-top: 65px;
            margin-top: auto;
            text-align: center;
        }

        .footer_copyright {
            margin-top: 50px;
            margin-bottom: 25px;
            font-size: 1rem;
            color: var(--color-light-gray);
        }

        .controls-container {
            max-width: 600px;
            width: 100%;
            margin: 25px auto;
            padding: 24px;
            border: 1px solid var(--color-light-gray);
            background-color: var(--color-background-gray);
            border-radius: 8px;
        }

        .firebase-status {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--color-white);
            border-radius: 8px;
            border: 1px solid var(--color-light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        @media (max-width: 600px) {
            .firebase-status {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--color-dark-gray);
        }

        .custom-input {
            max-width: 552px;
            width: 100%;
            resize: vertical;
            padding: 10px;
            border: 1px solid var(--color-light-gray);
            font-size: 1rem;
            color: var(--color-gray);
            background-color: var(--color-white);
            border-radius: 4px;
        }

        .custom-input:focus {
            border-color: var(--color-gray);
            outline: none;
        }

        .custom-dropdown {
            position: relative;
            width: 100%;
        }

        .select-selected {
            background-color: var(--color-white);
            border: 1px solid var(--color-light-gray);
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--color-gray);
        }

        .select-selected.disabled {
            background-color: #eee;
            color: #999;
            cursor: not-allowed;
        }

        .select-arrow {
            border: solid var(--color-gray);
            border-width: 0 2px 2px 0;
            display: inline-block;
            padding: 3px;
            transform: rotate(45deg);
            transition: transform 0.2s ease;
            margin-right: 5px;
            margin-bottom: 2px;
        }

        .select-selected.select-arrow-active .select-arrow {
            transform: rotate(-135deg);
            margin-bottom: -2px;
        }

        .select-items {
            position: absolute;
            background-color: var(--color-white);
            top: 100%;
            left: 0;
            right: 0;
            z-index: 99;
            border: 1px solid var(--color-light-gray);
            border-top: none;
            border-radius: 0 0 4px 4px;
            max-height: 250px;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .select-hide {
            display: none;
        }

        #category-search-input {
            width: 100%;
            padding: 10px;
            border: none;
            border-bottom: 1px solid var(--color-light-gray);
            outline: none;
            background-color: #FAFAFA;
        }

        .option-item {
            color: var(--color-dark-gray);
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f5f5f5;
        }

        .option-item:hover {
            background-color: var(--color-background-gray);
        }

        .button-group {
            max-width: 600px;
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: 2px solid var(--color-gray);
            background-color: transparent;
            color: var(--color-gray);
            font-size: 1rem;
            transition: all 0.3s ease;
            font-weight: 600;
            border-radius: 4px;
        }

        .btn:hover {
            background-color: var(--color-gray);
            color: var(--color-white);
        }

        .btn:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .result-container {
            margin-top: 20px;

            ul {
                border: 1px solid var(--color-light-gray);
                border-radius: 4px;
            }

            :empty {
                border: none;
            }
        }

        #result-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #fff;
            padding: 12px 15px;
        }

        .frequency-span {
            color: var(--color-light-gray);
            font-style: italic;
            font-size: 0.9rem;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--color-white);
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            position: relative;
            animation: slideDown 0.3s ease;

            p {
                margin: 25px 0;
            }
        }

        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            line-height: 1;
            cursor: pointer;
            color: var(--color-light-gray);
        }

        .modal-close-btn:hover {
            color: var(--color-dark-gray);
        }

        .info-icon-btn {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 20px;
            height: 20px;
            background-color: var(--color-light-gray);
            color: var(--color-white);
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }

        .label-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .label-wrapper label {
            margin-bottom: 0;
        }

        input[type="radio"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border: 2px solid #cbcbcb;
            border-radius: 0;
            outline: none;
            margin: 0;
            cursor: pointer;
        }

        input[type="radio"]:checked {
            background-color: var(--color-gray);
            border-color: var(--color-gray);
        }

        input[type="radio"]:hover {
            border-color: var(--color-gray);
        }

        @keyframes slideDown {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <main>
        <h1>–ö–æ—Ç–æ–ø–∞—Å—Ç</h1>
        <div class="centration-modif">
            <div class="tool-description">
                <p class="intro">–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö
                    –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–∫–ª–∏–∫–∞—Ç—å—Å—è, –∞ —Ç–∞–∫–∂–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤
                    —Å—Ç—É—Ä–∫—Ç—É—Ä—ã. </p>
                <p class="intro">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–µ –¥–µ–ª–∞–µ—Ç –≤—Å—é —Ä–∞–±–æ—Ç—É –∑–∞ –≤–∞—Å, –∞ –ª–∏—à—å —É—Å–∫–æ—Ä—è–µ—Ç —Ç–∞–º, –≥–¥–µ —É–∂–µ –±—ã–ª–∞ —Å–æ–±—Ä–∞–Ω–∞ –ë–î
                    –∑–∞–ø—Ä–æ—Å–æ–≤.<br> –¢–∞–º, –≥–¥–µ –∏—Ö –Ω–µ—Ç - –≤—ã –¥–æ–ª–∂–Ω—ã —Å–æ–±–∏—Ä–∞—Ç—å –∏—Ö —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ. <br>–í—ã —Ç–∞–∫ –∂–µ –º–æ–∂–µ—Ç–µ –¥–æ–ø–æ–ª–Ω—è—Ç—å
                    –ë–î
                    –∑–∞–ø—Ä–æ—Å–æ–≤, –¥–ª—è –æ–±–ª–µ–≥—á–µ–Ω–∏—è —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç—ã –∏ —Ä–∞–±–æ—Ç—ã –∫–æ–ª–ª–µ–≥ –≤ –±—É–¥—É—â–µ–º.</p>
            </div>
            <div style="display: flex;">
                <div class="controls-container">
                    <div class="firebase-status">
                        <div>
                            <h3 style="margin: 0 0 5px 0; color: var(--color-dark-gray);">–û–±–ª–∞—á–Ω–∞—è
                                –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
                            <p id="connection-status" style="margin: 0px; font-size: 0.9rem; color: green;">üü¢
                                –ü–æ–¥–∫–ª—é—á–µ–Ω–æ.
                                –†–∞–∑–¥–µ–ª–æ–≤: 6</p>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:</label>
                        <div class="custom-dropdown" id="custom-parent-select">
                            <div class="select-selected">
                                <span id="selected-parent-text">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</span>
                                <div class="select-arrow"></div>
                            </div>
                            <div class="select-items select-hide" id="parent-options-container">
                                <div class="option-item">–ê–ª–∫–æ–≥–æ–ª–∏–∑–º</div>
                                <div class="option-item">–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                                <div class="option-item">–ù–∞—Ä–∫–æ–º–∞–Ω–∏—è</div>
                                <div class="option-item">–ü—Å–∏—Ö–∏–∞—Ç—Ä–∏—è</div>
                                <div class="option-item">–†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è</div>
                                <div class="option-item">–°—Ç–∞—Ç—å–∏ - –ò–ù–§–û</div>
                            </div>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:</label>
                        <div class="custom-dropdown" id="custom-child-select">
                            <div class="select-selected disabled">
                                <span id="selected-category-text">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª</span>
                                <div class="select-arrow"></div>
                            </div>
                            <div class="select-items select-hide">
                                <input type="text" placeholder="–ü–æ–∏—Å–∫..." id="category-search-input" autocomplete="off">
                                <div id="category-options-container">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="control-group">
                        <label for="results-count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:</label>
                        <input type="number" id="results-count" class="custom-input" value="5" min="1">
                    </div>
                    <div class="control-group">
                        <div class="label-wrapper">
                            <label for="toponym-input">–¢–æ–ø–æ–Ω–∏–º –¥–ª—è –∑–∞–º–µ–Ω—ã:</label>
                            <button class="info-icon-btn" data-info="toponim" title="–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É">?</button>
                        </div>
                        <input type="text" id="toponym-input" class="custom-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–ª–∞–¥–∏–∫–∞–≤–∫–∞–∑">
                    </div>
                    <div class="button-group">
                        <button id="add-data-modal-btn" class="btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                        <button id="randomize-btn" class="btn">–†–∞–Ω–¥–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button id="copy-btn" class="btn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                    <div id="result-container" class="result-container">
                        <ul id="result-list"></ul>
                    </div>
                </div>
                <div class="controls-container">
                    <div class="control-group">
                        <div class="label-wrapper">
                            <label for="github-token">–¢–æ–∫–µ–Ω GitHub (Personal Access Token):</label>
                            <button class="info-icon-btn" data-info="token" title="–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É">?</button>
                        </div>
                        <input type="password" id="github-token" class="custom-input" placeholder="ghp_...">
                        <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                            –¢–æ–∫–µ–Ω –Ω—É–∂–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ GitHub Models.
                            <a href="https://github.com/settings/tokens" target="_blank">–°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω</a>.
                        </p>
                    </div>
                    <div class="control-group">
                        <div class="label-wrapper">
                            <label>–¢–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞:</label>
                            <button class="info-icon-btn" data-info="content" title="–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É">?</button>
                        </div>

                        <div style="display: flex; gap: 20px;">
                            <label><input type="radio" name="content-type" value="service" checked> –£—Å–ª—É–≥–∞</label>
                            <label><input type="radio" name="content-type" value="article"> –°—Ç–∞—Ç—å—è</label>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="label-wrapper">
                            <label for="prompt-template">–®–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞:</label>
                            <button class="info-icon-btn" data-info="maket" title="–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É">?</button>
                        </div>
                        <textarea id="prompt-template" class="custom-input" rows="8"></textarea>
                    </div>
                    <div class="custom-dropdown" id="custom-model-select">
                        <div class="select-selected">
                            <span id="selected-model-text">gpt-4o</span>
                            <div class="select-arrow"></div>
                        </div>
                        <div class="select-items select-hide" id="model-options-container">
                            <div class="option-item" data-value="gpt-4o">gpt-4o</div>
                            <div class="option-item" data-value="gpt-4o-mini">gpt-4o-mini</div>
                            <div class="option-item" data-value="Llama-3.3-70B">Llama-3.3-70B</div>
                        </div>
                    </div>
                    <input type="hidden" name="model" id="model-input" value="gpt-4o">
                    <div class="button-group" style="justify-content: space-between;">
                        <div
                            style="margin-bottom: 15px; padding: 10px; background: #fff; border-radius: 4px; border: 1px solid var(--color-light-gray);">
                            <span id="rate-limit-display">–°–µ–≥–æ–¥–Ω—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: -- –∏–∑ --</span>
                        </div>
                        <button id="generate-structure-btn" class="btn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É</button>
                    </div>
                    <div id="structure-result"
                        style="margin-top: 20px; padding: 15px; background: #fff; border-radius: 4px; white-space: pre-wrap; display: none; border: 1px solid var(--color-light-gray);">
                    </div>
                </div>
            </div>
        </div>
        </div>
    </main>
    <footer class="footer_container">
        <p class="footer_copyright">¬© 2026, Yatvig. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    </footer>
    <div id="add-data-modal" class="modal-overlay">
        <div class="modal-content" style="text-align: left;">
            <button class="modal-close-btn" id="close-add-modal">√ó</button>
            <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</h3>
            <div class="control-group">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                <input type="text" id="new-parent-input" class="custom-input" list="parent-list-hints"
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–ª–∫–æ–≥–æ–ª–∏–∑–º" autocomplete="off">
                <datalist id="parent-list-hints">
                    <option value="–ê–ª–∫–æ–≥–æ–ª–∏–∑–º"></option>
                    <option value="–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ"></option>
                    <option value="–ù–∞—Ä–∫–æ–º–∞–Ω–∏—è"></option>
                    <option value="–ü—Å–∏—Ö–∏–∞—Ç—Ä–∏—è"></option>
                    <option value="–†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è"></option>
                    <option value="–°—Ç–∞—Ç—å–∏ - –ò–ù–§–û"></option>
                </datalist>
            </div>
            <div class="control-group">
                <label>–†–∞–∑–¥–µ–ª:</label>
                <input type="text" id="new-child-input" class="custom-input" list="child-list-hints"
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í—ã–≤–æ–¥ –∏–∑ –∑–∞–ø–æ—è" autocomplete="off">
                <datalist id="child-list-hints"></datalist>
            </div>
            <div class="control-group">
                <label>–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å:</label>
                <input type="text" id="new-query-input" class="custom-input"
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≤—ã–≤–æ–¥ –∏–∑ –∑–∞–ø–æ—è –º–æ—Å–∫–≤–∞">
            </div>
            <div class="control-group">
                <label>–ß–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å:</label>
                <input type="number" id="new-freq-input" class="custom-input" value="100">
            </div>
            <button class="btn" id="save-new-data-btn" style="width: 100%; margin-top: 10px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤
                –æ–±–ª–∞–∫–æ</button>
        </div>
    </div>
    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn modal-close-trigger">√ó</button>
            <h3>–ü–æ–¥—Å–∫–∞–∑–∫–∞</h3>
            <p id="info-modal-text"></p>
            <button class="btn modal-close-trigger">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, doc, getDoc, setDoc, updateDoc, onSnapshot, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        const firebaseConfig = {
            apiKey: "AIzaSyCxEBDlOBK2QwduPO1S5ri9DpRBnoMhtt8",
            authDomain: "yatvig-a0214.firebaseapp.com",
            projectId: "yatvig-a0214",
            storageBucket: "yatvig-a0214.firebasestorage.app",
            messagingSenderId: "1049548595731",
            appId: "1:1049548595731:web:7fc9ca611648fc31ead5e6"
        };
        if (!firebaseConfig.apiKey) {
            showModal('–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', '–í—ã –Ω–µ –≤—Å—Ç–∞–≤–∏–ª–∏ firebaseConfig –≤ –∫–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á–∏.');
            throw new Error("Config missing");
        }
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const COLLECTION_NAME = "search_sections";
        let globalData = {};
        const connectionStatus = document.getElementById('connection-status');
        const parentSelect = document.getElementById('custom-parent-select');
        const parentSelectedText = document.getElementById('selected-parent-text');
        const parentOptionsContainer = document.getElementById('parent-options-container');
        const childSelect = document.getElementById('custom-child-select');
        const childSelectedText = document.getElementById('selected-category-text');
        const childOptionsContainer = document.getElementById('category-options-container');
        const searchInput = document.getElementById('category-search-input');
        const resultsCountInput = document.getElementById('results-count');
        const toponymInput = document.getElementById('toponym-input');
        const randomizeBtn = document.getElementById('randomize-btn');
        const copyBtn = document.getElementById('copy-btn');
        const resultList = document.getElementById('result-list');
        const addModal = document.getElementById('add-data-modal');
        const addBtn = document.getElementById('add-data-modal-btn');
        const closeAddBtns = document.querySelectorAll('#close-add-modal');
        const saveNewDataBtn = document.getElementById('save-new-data-btn');
        const newParentInput = document.getElementById('new-parent-input');
        const newChildInput = document.getElementById('new-child-input');
        const newQueryInput = document.getElementById('new-query-input');
        const newFreqInput = document.getElementById('new-freq-input');
        const parentHints = document.getElementById('parent-list-hints');
        const childHints = document.getElementById('child-list-hints');
        let currentParentValue = '';
        let currentChildValue = '';
        let currentListData = [];
        const originalCopyBtnText = copyBtn.textContent;
        function showModal(title, message) {
            const modal = document.getElementById('info-modal');
            const modalTitle = modal.querySelector('h3');
            const modalText = document.getElementById('info-modal-text');
            if (modalTitle) modalTitle.textContent = title;
            if (modalText) modalText.textContent = message;
            modal.classList.add('active');
        }
        onSnapshot(collection(db, COLLECTION_NAME), (snapshot) => {
            const newData = {};
            let isEmpty = true;

            snapshot.forEach((doc) => {
                // doc.id = –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ö—É–ª–∏–Ω–∞—Ä–∏—è")
                // doc.data() = –û–±—ä–µ–∫—Ç —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, { "–°—É–ø—ã": [...] })
                newData[doc.id] = doc.data();
                isEmpty = false;
            });

            globalData = newData;
            connectionStatus.textContent = `üü¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ. –†–∞–∑–¥–µ–ª–æ–≤: ${Object.keys(globalData).length}`;
            connectionStatus.style.color = 'green';
            if (isEmpty) {
                parentSelectedText.textContent = "–ë–∞–∑–∞ –ø—É—Å—Ç–∞";
            } else {
                refreshUI();
            }
        }, (error) => {
            console.error("–û—à–∏–±–∫–∞ Firebase:", error);
            connectionStatus.textContent = `üî¥ –û—à–∏–±–∫–∞: ${error.message}`;
            connectionStatus.style.color = 'red';
        });
        function refreshUI() {
            renderParentOptions();
            updateHints();
            if (currentParentValue && globalData[currentParentValue]) {
                renderChildOptions(currentParentValue);
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –ø—Ä–æ–±—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                if (currentChildValue && globalData[currentParentValue][currentChildValue]) {
                    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–æ–∂–Ω–æ –Ω–µ –¥–µ–ª–∞—Ç—å –∞–≤—Ç–æ-—Ä–∞–Ω–¥–æ–º, —á—Ç–æ–±—ã –Ω–µ —Å–±–∏–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                }
            } else {
                // –°–±—Ä–æ—Å, –µ—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É–¥–∞–ª–∏–ª–∏
                parentSelectedText.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é";
                currentParentValue = '';
            }
        }
        function updateHints() {
            parentHints.innerHTML = '';
            childHints.innerHTML = '';
            Object.keys(globalData).forEach(key => {
                const opt = document.createElement('option');
                opt.value = key;
                parentHints.appendChild(opt);
            });
        }
        newParentInput.addEventListener('input', () => {
            const val = newParentInput.value;
            childHints.innerHTML = '';
            if (globalData[val]) {
                Object.keys(globalData[val]).forEach(childKey => {
                    const opt = document.createElement('option');
                    opt.value = childKey;
                    childHints.appendChild(opt);
                });
            }
        });
        function renderParentOptions() {
            parentOptionsContainer.innerHTML = '';
            const parentKeys = Object.keys(globalData).sort();

            if (parentKeys.length === 0) return;

            parentKeys.forEach((key) => {
                const div = document.createElement('div');
                div.textContent = key;
                div.className = 'option-item';
                div.addEventListener('click', () => selectParent(key));
                parentOptionsContainer.appendChild(div);
            });
        }
        function selectParent(value, closeMenu = true) {
            currentParentValue = value;
            parentSelectedText.textContent = value;
            if (closeMenu) toggleSelect(parentSelect, false);
            renderChildOptions(value);
            // –°–±—Ä–æ—Å —Ä–µ–±–µ–Ω–∫–∞
            childSelectedText.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é";
            currentChildValue = '';
            childSelect.querySelector('.select-selected').classList.remove('disabled');
        }
        function renderChildOptions(parentKey) {
            childOptionsContainer.innerHTML = '';
            const subCategories = globalData[parentKey];
            if (!subCategories) return;
            const childKeys = Object.keys(subCategories).sort();
            childKeys.forEach((key) => {
                const div = document.createElement('div');
                div.textContent = key;
                div.className = 'option-item';
                div.addEventListener('click', () => selectChild(key));
                childOptionsContainer.appendChild(div);
            });
        }
        function selectChild(value, closeMenu = true) {
            currentChildValue = value;
            childSelectedText.textContent = value;
            if (closeMenu) toggleSelect(childSelect, false);
            searchInput.value = '';
            filterOptions('');
            handleRandomize();
        }
        function toggleSelect(selectElement, forceState) {
            const items = selectElement.querySelector('.select-items');
            const selectedDiv = selectElement.querySelector('.select-selected');
            if (!items.classList.contains('select-hide') === false && forceState !== false) {
                closeAllSelects(selectElement);
            }
            if (forceState !== undefined) {
                if (forceState) {
                    items.classList.remove('select-hide');
                    selectedDiv.classList.add('select-arrow-active');
                } else {
                    items.classList.add('select-hide');
                    selectedDiv.classList.remove('select-arrow-active');
                }
            } else {
                items.classList.toggle('select-hide');
                selectedDiv.classList.toggle('select-arrow-active');
            }
        }
        function closeAllSelects(exceptElement) {
            [parentSelect, childSelect].forEach(sel => {
                if (sel !== exceptElement) {
                    sel.querySelector('.select-items').classList.add('select-hide');
                    sel.querySelector('.select-selected').classList.remove('select-arrow-active');
                }
            });
        }
        parentSelect.querySelector('.select-selected').addEventListener('click', (e) => { e.stopPropagation(); toggleSelect(parentSelect); });
        childSelect.querySelector('.select-selected').addEventListener('click', (e) => {
            if (currentParentValue) {
                e.stopPropagation();
                toggleSelect(childSelect);
                if (!childSelect.querySelector('.select-items').classList.contains('select-hide')) searchInput.focus();
            }
        });
        document.addEventListener('click', () => closeAllSelects(null));
        searchInput.addEventListener('click', (e) => e.stopPropagation());
        searchInput.addEventListener('input', (e) => filterOptions(e.target.value));
        function filterOptions(text) {
            const filter = text.toLowerCase();
            const options = childOptionsContainer.getElementsByClassName('option-item');
            for (let div of options) {
                div.style.display = (div.textContent || div.innerText).toLowerCase().indexOf(filter) > -1 ? "" : "none";
            }
        }
        function handleRandomize() {
            const resultsCount = parseInt(resultsCountInput.value, 10);
            const toponym = toponymInput.value.trim();
            if (currentParentValue && currentChildValue &&
                globalData[currentParentValue] && globalData[currentParentValue][currentChildValue]) {
                const data = globalData[currentParentValue][currentChildValue];
                let randomized = [...data].sort(() => 0.5 - Math.random()).slice(0, resultsCount);
                if (toponym) {
                    const targets = ["–º–æ—Å–∫–≤–∞", "–º–æ—Å–∫–≤–µ", "–º–æ—Å–∫–≤—ã"];
                    randomized = randomized.map(item => {
                        let q = item.query;
                        targets.forEach(t => {
                            const regex = new RegExp(`(^|[\\s])(${t})(?=$|[\\s.,!?])`, 'gi');
                            q = q.replace(regex, `$1${toponym}`);
                        });
                        return { ...item, query: q };
                    });
                }
                displayResults(randomized);
            } else {
                displayResults([]);
            }
        }
        function displayResults(list) {
            resultList.innerHTML = '';
            currentListData = [];
            if (!list || list.length === 0) {
                resultList.innerHTML = '<li>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö.</li>';
                copyBtn.disabled = true;
                return;
            }
            list.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${item.query}</span><span class="frequency-span">–ß–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å: </br> ${item.frequency}</span>`;
                resultList.appendChild(li);
                currentListData.push(item.query);
            });
            copyBtn.disabled = false;
        }
        randomizeBtn.addEventListener('click', handleRandomize);
        copyBtn.addEventListener('click', () => {
            if (copyBtn.disabled || currentListData.length === 0) return;
            navigator.clipboard.writeText(currentListData.join('\n')).then(() => {
                const t = copyBtn.textContent;
                copyBtn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                copyBtn.disabled = true;
                setTimeout(() => { copyBtn.textContent = t; copyBtn.disabled = false; }, 2000);
            });
        });
        const generateBtn = document.getElementById('generate-structure-btn');
        const structureResult = document.getElementById('structure-result');
        const tokenInput = document.getElementById('github-token');
        const promptTemplate = document.getElementById('prompt-template');
        const modelInput = document.getElementById('model-input');
        const rateLimitDisplay = document.getElementById('rate-limit-display');
        const typeRadios = document.querySelectorAll('input[name="content-type"]');
        const serviceTemplate = `–ù—É–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å–∞–π—Ç–∞ —á–∞—Å—Ç–Ω–æ–π –Ω–∞—Ä–∫–æ–∫–ª–∏–Ω–∏–∫–∏. –î–ª—è —ç—Ç–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤. 
–ù—É–∂–Ω–æ –ø—Ä–∏–¥—É–º–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ, —á—Ç–æ–±—ã –ø–æ –∏—Ç–æ–≥—É –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Å–∞–π—Ç–∞ –±—ã–ª–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —á–∏—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç, –Ω–æ –Ω–µ –ø–µ—Ä–µ–≥–∏–±–∞—Ç—å —Å –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å—é. –ù3 –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≤–∏–¥–µ—Ç—å —Ç–∞–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–∞–∫ (—Å—Ç–∞–¥–∏–∏ –±–æ–ª–µ–∑–Ω–∏, —ç—Ç–∞–ø—ã –ª–µ—á–µ–Ω–∏—è, –ø–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã, –º–µ—Ç–æ–¥—ã, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ, —á—Ç–æ —Ç–∞–∫–æ–µ, –∫–æ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç –∏ —Ç.–¥. (—Å—Ç–∞—Ä–∞–π—Å—è –ø—Ä–∏–¥—É–º–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∞ –Ω–µ –≤—Ç—É–ø—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –≤ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ)) 
–ù–µ –¥–µ–ª–∞–π –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–º–∏ (–¥–æ 11 —Å–ª–æ–≤)

–¢–∏–ø —Ç–µ–∫—Å—Ç–∞: –£—Å–ª—É–≥–∞ (–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è)

–ö–æ–ª-–≤–æ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ù2 –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 16 —à—Ç, –±–µ–∑ —É—á–µ—Ç–∞ H1.

–ù–∞–∑–≤–∞–Ω–∏–µ: ‚Äú{{title}}‚Äù

Keywords: ‚Äú{{keys}}‚Äù

–û—Ç–≤–µ—Ç –ø–∏—à–∏ –±–µ–∑ –º–∞—Ä–∫–∏—Ä–æ–≤–æ–∫, —Ç–∞–±—É–ª—è—Ü–∏–π –∏ –ø—Ä–æ—á–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤, –∫—Ä–æ–º–µ —Ç–∏—Ä–µ, –≤–æ—Ç –ø—Ä–∏–º–µ—Ä  –∏ —Å—Ç–∏–ª—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è:

H2 - * –∑–∞–≥–æ–ª–æ–≤–æ–∫ *
H2 - * –∑–∞–≥–æ–ª–æ–≤–æ–∫ *
H2 - * –∑–∞–≥–æ–ª–æ–≤–æ–∫ *`;

        const articleTemplate = `–ù—É–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å–∞–π—Ç–∞ —á–∞—Å—Ç–Ω–æ–π –Ω–∞—Ä–∫–æ–∫–ª–∏–Ω–∏–∫–∏. –î–ª—è —ç—Ç–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤. 
–ù—É–∂–Ω–æ –ø—Ä–∏–¥—É–º–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ, —á—Ç–æ–±—ã –ø–æ –∏—Ç–æ–≥—É –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Å–∞–π—Ç–∞ –±—ã–ª–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —á–∏—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç, –Ω–æ –Ω–µ –ø–µ—Ä–µ–≥–∏–±–∞—Ç—å —Å –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å—é. –ù3 –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≤–∏–¥–µ—Ç—å —Ç–∞–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–∞–∫ (—Å—Ç–∞–¥–∏–∏ –±–æ–ª–µ–∑–Ω–∏, —ç—Ç–∞–ø—ã –ª–µ—á–µ–Ω–∏—è, –ø–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã, –º–µ—Ç–æ–¥—ã, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ, —á—Ç–æ —Ç–∞–∫–æ–µ, –∫–æ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç –∏ —Ç.–¥.) 

–¢–∏–ø —Ç–µ–∫—Å—Ç–∞: –°—Ç–∞—Ç—å—è (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è)

–ö–æ–ª-–≤–æ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ù2 –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 16 —à—Ç, –±–µ–∑ —É—á–µ—Ç–∞ H1.

–ù–∞–∑–≤–∞–Ω–∏–µ: ‚Äú{{title}}‚Äù

Keywords: ‚Äú{{keys}}‚Äù


–û—Ç–≤–µ—Ç –ø–∏—à–∏ –±–µ–∑ –º–∞—Ä–∫–∏—Ä–æ–≤–æ–∫, —Ç–∞–±—É–ª—è—Ü–∏–π –∏ –ø—Ä–æ—á–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤, –∫—Ä–æ–º–µ —Ç–∏—Ä–µ, –≤–æ—Ç –ø—Ä–∏–º–µ—Ä  –∏ —Å—Ç–∏–ª—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è:

H2 - *–∫–∞–∫–æ–π-—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫*
H2 - *–∫–∞–∫–æ–π-—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫*`;

        const STORAGE_KEY_SERVICE = 'saved_prompt_service';
        const STORAGE_KEY_ARTICLE = 'saved_prompt_article';

        function loadPromptForType(type) {
            const key = type === 'service' ? STORAGE_KEY_SERVICE : STORAGE_KEY_ARTICLE;
            const saved = localStorage.getItem(key);
            const defaultValue = type === 'service' ? serviceTemplate : articleTemplate;
            if (saved && saved.trim() !== '') {
                promptTemplate.value = saved;
            } else {
                promptTemplate.value = defaultValue;
            }
        }
        function savePromptForCurrentType() {
            const currentType = document.querySelector('input[name="content-type"]:checked').value;
            const key = currentType === 'service' ? STORAGE_KEY_SERVICE : STORAGE_KEY_ARTICLE;
            const value = promptTemplate.value;
            localStorage.setItem(key, value);
        }
        loadPromptForType('service');
        typeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                loadPromptForType(e.target.value);
            });
        });
        promptTemplate.addEventListener('input', savePromptForCurrentType);
        const DAILY_LIMIT = 150; // —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ª–∏–º–∏—Ç GitHub Models
        function getTodayKey() {
            const now = new Date();
            return `usage_${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`;
        }
        function getTodayUsage() {
            const key = getTodayKey();
            const val = localStorage.getItem(key);
            return val ? parseInt(val, 10) : 0;
        }
        function incrementUsage() {
            const key = getTodayKey();
            const current = getTodayUsage();
            localStorage.setItem(key, current + 1);
        }
        function updateRateLimitDisplay() {
            const used = getTodayUsage();
            document.getElementById('rate-limit-display').textContent =
                `–°–µ–≥–æ–¥–Ω—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${used} –∏–∑ ${DAILY_LIMIT}`;
        }
        updateRateLimitDisplay();
        async function callGitHubModels(prompt, token, model) {
            const response = await fetch('https://models.inference.ai.azure.com/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    model: model,
                    messages: [
                        { role: 'system', content: '–¢—ã –ø–æ–º–æ—â–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç–∞—Ç–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤.' },
                        { role: 'user', content: prompt }
                    ],
                    max_tokens: 2000,
                    temperature: 0.7
                })
            });
            if (response.ok) {
                incrementUsage();
                updateRateLimitDisplay();
            }
            if (!response.ok) {
                let errorMsg = `HTTP ${response.status}`;
                try {
                    const error = await response.json();
                    errorMsg = error.error?.message || errorMsg;
                } catch (e) { }
                throw new Error(errorMsg);
            }
            const data = await response.json();
            return data.choices[0].message.content;
        }
        generateBtn.addEventListener('click', async () => {
            if (!currentChildValue) {
                showModal('–í–Ω–∏–º–∞–Ω–∏–µ', '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é!');
                return;
            }
            const keyItems = document.querySelectorAll('#result-list li span:first-child');
            if (keyItems.length === 0) {
                showModal('–í–Ω–∏–º–∞–Ω–∏–µ', '–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π (–∫–Ω–æ–ø–∫–∞ "–†–∞–Ω–¥–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å")');
                return;
            }
            const keys = Array.from(keyItems).map(span => span.textContent).join(', ');
            let template = promptTemplate.value;
            template = template.replace(/\{\{keys\}\}/g, keys);
            template = template.replace(/\{\{title\}\}/g, currentChildValue);
            const token = tokenInput.value.trim();
            if (!token) {
                showModal('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω GitHub');
                return;
            }
            const model = modelInput.value;
            generateBtn.disabled = true;
            const originalText = generateBtn.textContent;
            generateBtn.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...';
            structureResult.style.display = 'block';
            structureResult.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...';
            try {
                const result = await callGitHubModels(template, token, model);
                structureResult.textContent = result;
            } catch (error) {
                structureResult.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
                console.error(error);
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = originalText;
            }
        });
        updateRateLimitDisplay();
        addBtn.addEventListener('click', () => {
            addModal.classList.add('active');
            updateHints();
        });
        closeAddBtns.forEach(b => b.addEventListener('click', () => addModal.classList.remove('active')));
        saveNewDataBtn.addEventListener('click', async () => {
            const p = newParentInput.value.trim();
            const c = newChildInput.value.trim();
            const q = newQueryInput.value.trim();
            const f = parseInt(newFreqInput.value, 10);
            if (!p || !c || !q) {
                showModal('–û—à–∏–±–∫–∞', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            const originalBtnText = saveNewDataBtn.textContent;
            saveNewDataBtn.textContent = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...";
            saveNewDataBtn.disabled = true;
            try {
                const sectionRef = doc(db, COLLECTION_NAME, p);
                const docSnap = await getDoc(sectionRef);
                let currentSectionData = {};
                if (docSnap.exists()) {
                    currentSectionData = docSnap.data();
                }
                if (!currentSectionData[c]) {
                    currentSectionData[c] = [];
                }
                const exists = currentSectionData[c].some(item => item.query === q);
                if (exists) {
                    showModal('–î—É–±–ª–∏–∫–∞—Ç', '–¢–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å —É–∂–µ –µ—Å—Ç—å –≤ –±–∞–∑–µ!');
                    saveNewDataBtn.textContent = originalBtnText;
                    saveNewDataBtn.disabled = false;
                    return;
                }
                currentSectionData[c].push({ query: q, frequency: f || 0 });
                await setDoc(sectionRef, currentSectionData, { merge: true });
                newQueryInput.value = '';
                showModal('–£—Å–ø–µ—à–Ω–æ', `‚úì –ó–∞–ø—Ä–æ—Å "${q}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –æ–±–ª–∞–∫–æ!`);
                saveNewDataBtn.textContent = originalBtnText;
                saveNewDataBtn.disabled = false;
                currentParentValue = p;
                currentChildValue = c;
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", e);
                showModal('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + e.message);
                saveNewDataBtn.textContent = originalBtnText;
                saveNewDataBtn.disabled = false;
            }
        });
        const infoBtn = document.getElementById('info-btn');
        const infoModal = document.getElementById('info-modal');
        if (infoBtn) infoBtn.addEventListener('click', () => infoModal.classList.add('active'));
        document.querySelectorAll('.modal-close-trigger').forEach(b => b.addEventListener('click', () => infoModal.classList.remove('active')));
        function showInfoModal(text) {
            const modal = document.getElementById('info-modal');
            const modalText = document.getElementById('info-modal-text');
            if (modalText) {
                modalText.textContent = text;
            }
            modal.classList.add('active');
        }
        document.querySelectorAll('.info-icon-btn[data-info]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation(); // —á—Ç–æ–±—ã –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–æ—Å—å —Å—Ä–∞–∑—É
                const type = btn.getAttribute('data-info');
                let message = '';
                switch (type) {
                    case 'token':
                        message = '–í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ç–æ–∫–µ–Ω GitHub, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å ghp_. –°–æ–∑–¥–∞—Ç—å –º–æ–∂–Ω–æ –Ω–∞ github.com/settings/tokens (–≤—ã–±–µ—Ä–∏—Ç–µ "Classic token", –±–µ—Å—Å—Ä–æ—á–Ω—ã–π, –±–µ–∑ –ø—Ä–∞–≤).';
                        break;
                    case 'model':
                        message = '–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. gpt-4o ‚Äî –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç. gpt-4o-mini ‚Äî –±—ã—Å—Ç—Ä–µ–µ, –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∏–∂–µ. Llama-3.3-70B ‚Äî —Ö–∑ –≤–æ–æ–±—â–µ. –£ –≤—Å–µ—Ö –æ–±—â–∏–π –ª–∏–º–∏—Ç 150 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å.';
                        break;
                    case 'content':
                        message = '–í—ã–±–µ—Ä–∏—Ç–µ –±–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ —Ç–∏–ø–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã';
                        break;
                    case 'toponim':
                        message = '–ù–∞–ø–∏—à–∏—Ç–µ —Ç–æ–ø–æ–Ω–∏–º –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–¥–º–µ–Ω—è—Ç—å "–ú–æ—Å–∫–≤—É"';
                        break;
                    case 'maket':
                        message = '–ù–∞–ø–∏—à–∏—Ç–µ —à–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ {{keys}} –∏ {{title}} –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∫–ª—é—á–µ–π –∏ –Ω–∞–∑–≤–∞–Ω–∏—è —É—Å–ª—É–≥–∏ / —Å—Ç–∞—Ç—å–∏. –ü—Ä–æ–º–ø—Ç –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å.';
                        break;
                    default:
                        message = '–ü–æ–¥—Å–∫–∞–∑–∫–∞';
                }
                showInfoModal(message);
            });
        });
        (function () {
            const modelWrapper = document.getElementById('custom-model-select');
            const modelSelectedDiv = modelWrapper.querySelector('.select-selected');
            const modelSelectedText = document.getElementById('selected-model-text');
            const modelOptionsContainer = document.getElementById('model-options-container');
            const modelHiddenInput = document.getElementById('model-input');
            const modelOptionItems = modelOptionsContainer.querySelectorAll('.option-item');
            modelSelectedDiv.addEventListener('click', function (e) {
                e.stopPropagation();
                document.querySelectorAll('.select-items').forEach(container => {
                    if (container !== modelOptionsContainer) {
                        container.classList.add('select-hide');
                        container.previousElementSibling.classList.remove('select-arrow-active');
                    }
                });
                modelOptionsContainer.classList.toggle('select-hide');
                modelSelectedDiv.classList.toggle('select-arrow-active');
            });
            modelOptionItems.forEach(item => {
                item.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const value = this.getAttribute('data-value') || this.textContent;
                    modelSelectedText.textContent = this.textContent;
                    modelHiddenInput.value = value;
                    modelOptionsContainer.classList.add('select-hide');
                    modelSelectedDiv.classList.remove('select-arrow-active');
                });
            });
        })();
        document.addEventListener('click', function () {
            document.querySelectorAll('.select-items').forEach(container => {
                container.classList.add('select-hide');
                container.previousElementSibling.classList.remove('select-arrow-active');
            });
        });
    </script>
</body>

</html>
